<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <link rel="stylesheet" href="/src/style/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Turizimaz Admin Dashboard</title>
</head>
<body class="bg-gray-100">
  <div class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <div class="bg-gray-800 text-white w-64 flex-shrink-0">
      <div class="p-4 border-b border-gray-700">
        <h1 class="text-xl font-bold flex items-center">
          <i class="fas fa-crown mr-2 text-yellow-400"></i>
          Turizimaz Admin
        </h1>
      </div>
      <nav class="p-4">
        <ul class="space-y-2">
          <li>
            <a href="/admindashboard.html" class="flex items-center p-3 rounded-lg bg-gray-700 text-white">
              <i class="fas fa-tachometer-alt mr-3"></i>
              Dashboard
            </a>
          </li>
          <li>
            <a href="/adminapartments.html" class="flex items-center p-3 rounded-lg hover:bg-gray-700 text-gray-300 hover:text-white">
              <i class="fas fa-building mr-3"></i>
              Apartments
            </a>
          </li>
          <li>
            <a href="/adminbookings.html" class="flex items-center p-3 rounded-lg hover:bg-gray-700 text-gray-300 hover:text-white">
              <i class="fas fa-calendar-check mr-3"></i>
              Bookings
            </a>
          </li>
          <li>
            <a href="/adminuser.html" class="flex items-center p-3 rounded-lg hover:bg-gray-700 text-gray-300 hover:text-white">
              <i class="fas fa-users mr-3"></i>
              Users
            </a>
          </li>
        </ul>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="flex-1 overflow-auto">
      <!-- Header -->
      <header class="bg-white shadow-sm">
        <div class="px-6 py-4 flex justify-between items-center">
          <h2 class="text-xl font-semibold text-gray-800">Dashboard</h2>
          <div class="flex items-center space-x-4">
            <span id="adminName" class="text-gray-600">Admin</span>
            <button id="logoutBtn" class="text-red-600 hover:text-red-800">
              <i class="fas fa-sign-out-alt"></i> Çıxış
            </button>
          </div>
        </div>
      </header>

      <!-- Dashboard Content -->
      <main class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div class="bg-white p-6 rounded-xl shadow-md">
            <h3 class="text-gray-500 text-sm font-medium">Ümumi İstifadəçilər</h3>
            <p class="text-3xl font-bold mt-1" id="totalUsers">0</p>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-md">
            <h3 class="text-gray-500 text-sm font-medium">Aktiv Rezervasiyalar</h3>
            <p class="text-3xl font-bold mt-1" id="activeBookings">0</p>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-md">
            <h3 class="text-gray-500 text-sm font-medium">Yeni Rəylər</h3>
            <p class="text-3xl font-bold mt-1" id="newReviews">0</p>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-md">
            <h3 class="text-gray-500 text-sm font-medium">Ümumi Gəlir</h3>
            <p class="text-3xl font-bold mt-1" id="totalRevenue">$0</p>
          </div>
        </div>

        <!-- Recent Activities -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
          <h3 class="text-lg font-semibold mb-4">Son Fəaliyyətlər</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">İstifadəçi</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fəaliyyət</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarix</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200" id="recentActivities">
                <!-- JavaScript ilə doldurulacaq -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Recent Bookings -->
        <div class="bg-white p-6 rounded-xl shadow-md">
          <h3 class="text-lg font-semibold mb-4">Son Rezervasiyalar</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ev</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">İstifadəçi</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarix</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200" id="recentBookings">
                <!-- JavaScript ilə doldurulacaq -->
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Sadəcə ad yazmaq üçün statik "Admin"
      document.getElementById('adminName').textContent = 'Admin';

      // Logout sadəcə yenidən yönləndirir
      document.getElementById('logoutBtn').addEventListener('click', function () {
        window.location.href = '/login.html';
      });

      loadDashboardData();
    });

    async function loadDashboardData() {
      try {
        const usersResponse = await fetch('http://localhost:8000/users');
        const bookingsResponse = await fetch('http://localhost:8000/bookings');

        if (!usersResponse.ok || !bookingsResponse.ok) throw new Error('Data fetch error');

        const users = await usersResponse.json();
        const bookings = await bookingsResponse.json();

        document.getElementById('totalUsers').textContent = users.length;
        document.getElementById('activeBookings').textContent = bookings.filter(b => b.status === 'active').length;

        updateRecentActivities(users);
        updateRecentBookings(bookings);
      } catch (error) {
        console.error('Dashboard yüklənmə xətası:', error);
      }
    }

    function updateRecentActivities(users) {
      const activitiesTable = document.getElementById('recentActivities');
      const recentUsers = users.slice(-5).reverse();
      activitiesTable.innerHTML = recentUsers.map(user => `
        <tr>
          <td class="px-6 py-4">${user.id}</td>
          <td class="px-6 py-4">${user.fullname || user.username}</td>
          <td class="px-6 py-4">Qeydiyyat</td>
          <td class="px-6 py-4">${new Date(user.createdAt).toLocaleDateString()}</td>
        </tr>
      `).join('');
    }

    function updateRecentBookings(bookings) {
      const bookingsTable = document.getElementById('recentBookings');
      const recentBookings = bookings.slice(-5).reverse();
      bookingsTable.innerHTML = recentBookings.map(booking => `
        <tr>
          <td class="px-6 py-4">${booking.id}</td>
          <td class="px-6 py-4">${booking.apartmentName || 'Mənzil'}</td>
          <td class="px-6 py-4">${booking.userName || 'İstifadəçi'}</td>
          <td class="px-6 py-4">${new Date(booking.date).toLocaleDateString()}</td>
          <td class="px-6 py-4">
            <span class="px-2 py-1 text-xs rounded-full ${booking.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
              ${booking.status || 'pending'}
            </span>
          </td>
        </tr>
      `).join('');
    }
  </script>
  <script type="module" src="./src/jsfolder/adminjsfolder/admin.js"></script>
</body>
</html>
